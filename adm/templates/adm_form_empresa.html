<!DOCTYPE html>
{% extends "t_base.html" %}
{% block content %}

<style>
.avatar-logo-circle {
    border: 3px solid #0D6EFD !important;
    position: relative;
}

.avatar-logo-circle input[type="file"] {
    display: none;
}

.avatar-logo-circle .upload-icon {
    position: absolute;
    bottom: 0;
    right: 0;
    background-color: #FFF;
    border: 1px solid #0D6EFD;
    border-radius: 50%;
    padding: 8px 12px;
    cursor: pointer;
}

.avatar-logo-circle .upload-icon i {
    font-size: 1.2em;
    color: #0D6EFD;
}

.autocomplete-suggestions {
    border: 1px solid #d4d4d4;
    max-height: 150px;
    margin-top: 43px;
    overflow-y: auto;
    background-color: white;
    position: absolute;
    z-index: 1000;
    width: 100%;
    display: none;
}

.autocomplete-suggestion {
    padding: 8px;
    cursor: pointer;
}

.autocomplete-suggestion:hover {
    background-color: #e9e9e9;
}

.iti {
    width: 100%;
}
</style>

<div class="content container-fluid mt-5">
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">{{ empresa.nome|default:"Nova Empresa" }}</h4>
          </div>
          <div class="card-body">
            <!-- Logo Upload -->
            <div class="row mb-4">
                <label for="nome" class="col-sm-3 col-form-label form-label">Logo</label>
                <div class="col-sm-9">
                  <div class="" style="display: flex;justify-content: center;flex-direction: row;align-items: center;">
                    <div class="avatar-container">
                        <span class="avatar avatar-xxl avatar-circle avatar-logo-circle">
                            <img id="avatarPreview" class="avatar-img" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/User-avatar.svg/2048px-User-avatar.svg.png" alt="Logo da Empresa">
                            <label class="upload-icon" for="fileUploader">
                                <i class="bi bi-camera"></i>
                            </label>
                            <input type="file" id="fileUploader" name="avatar" onchange="previewImage(event)">
                        </span>
                    </div>
                  </div>
                </div>
              </div>

            <!-- General Info -->
            <div class="row mb-4">
              <label for="nome" class="col-sm-3 col-form-label form-label">Nome</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" name="nome" id="nome" value="{{ empresa.nome|default:'' }}">
              </div>
            </div>

            <div class="row mb-4">
              <label for="descricao" class="col-sm-3 col-form-label form-label">Descrição</label>
              <div class="col-sm-9">
                <textarea class="form-control" name="descricao" id="descricao">{{ empresa.descricao|default:'' }}</textarea>
              </div>
            </div>

            <div class="row mb-4">
              <label for="razao_social" class="col-sm-3 col-form-label form-label">Razão Social</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" name="razao_social" id="razao_social" value="{{ empresa.razao_social|default:'' }}">
              </div>
            </div>

            <div class="row mb-4">
              <label for="cnpj" class="col-sm-3 col-form-label form-label">CNPJ</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" name="cnpj" id="cnpj" value="{{ empresa.cnpj|default:'' }}">
              </div>
            </div>

            <!-- Contact Info -->
            <div class="row mb-4">
              <label for="telefone" class="col-sm-3 col-form-label form-label">Telefone</label>
              <div class="col-sm-9">
                <input type="tel" class="form-control" name="telefone" id="telefone" value="{{ empresa.telefone|default:'' }}" placeholder="(00) 00000-0000">
              </div>
            </div>

            <div class="row mb-4">
              <label for="email" class="col-sm-3 col-form-label form-label">Email</label>
              <div class="col-sm-9">
                <input type="email" class="form-control" name="email" id="email" value="{{ empresa.email|default:'' }}">
              </div>
            </div>

            <div class="row mb-4">
              <label for="site" class="col-sm-3 col-form-label form-label">Website</label>
              <div class="col-sm-9">
                <input type="url" class="form-control" name="site" id="site" value="{{ empresa.site|default:'' }}">
              </div>
            </div>

            <!-- Social Media -->
            <div class="row mb-4">
              <label for="linkedin" class="col-sm-3 col-form-label form-label">LinkedIn</label>
              <div class="col-sm-9">
                <input type="url" class="form-control" name="linkedin" id="linkedin" value="{{ empresa.linkedin|default:'' }}">
              </div>
            </div>

            <div class="row mb-4">
              <label for="facebook" class="col-sm-3 col-form-label form-label">Facebook</label>
              <div class="col-sm-9">
                <input type="url" class="form-control" name="facebook" id="facebook" value="{{ empresa.facebook|default:'' }}">
              </div>
            </div>

            <!-- SFTP Settings -->
            <div class="row mb-4">
                <label class="col-sm-3 col-form-label form-label">SFTP Host</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" name="sftp_host" id="sftp_host" value="{{ empresa.sftp_host|default:'' }}">
                </div>
            </div>

            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">SFTP Porta</label>
              <div class="col-sm-9">
                  <input type="number" class="form-control" name="sftp_port" id="sftp_port" value="{{ empresa.sftp_port|default:'' }}">
              </div>
            </div>
            
            <div class="row mb-4">
                <label class="col-sm-3 col-form-label form-label">SFTP Usuário</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" name="sftp_user" id="sftp_user" value="{{ empresa.sftp_user|default:'' }}">
                </div>
            </div>
            
            <!-- Escolha entre Senha ou Arquivo -->
            <div class="row mb-4">
                <label class="col-sm-3 col-form-label form-label">Senha SFTP</label>
                <div class="col-sm-9">
                    <input type="password" class="form-control" name="sftp_password" id="sftp_password" placeholder="Digite a senha (ou deixe vazio se usar uma chave)">
                </div>
            </div>
            
            <div class="row mb-4">
                <label class="col-sm-3 col-form-label form-label">Chave Privada (KEY)</label>
                <div class="col-sm-9">
                    <input type="file" class="form-control" name="sftp_key" id="sftp_key">
                    {% if empresa.sftp_key %}
                    <small class="form-text">Chave atual: <a href="{{ empresa.sftp_key.url }}" download>{{ empresa.sftp_key.name }}</a></small>
                    {% endif %}
                </div>
            </div>    
          </div>
          <div class="card-footer text-end">
            <a href="{% url 'adm_listar_empresas' %}" class="btn btn-secondary me-2">Cancelar</a>
            <button type="submit" class="btn btn-primary">Salvar</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<script>
    document.getElementById('sftp_password').addEventListener('input', function () {
      document.getElementById('sftp_key').value = '';
    });
  
    document.getElementById('sftp_key').addEventListener('change', function () {
      document.getElementById('sftp_password').value = '';
    });
  </script>


<script>
  function previewImage(event) {
      const reader = new FileReader();
      reader.onload = function() {
          const output = document.getElementById('avatarPreview');
          output.src = reader.result;
      };
      reader.readAsDataURL(event.target.files[0]);
  }
</script>
{% endblock %}
